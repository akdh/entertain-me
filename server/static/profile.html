<!doctype html>
<html ng-app="app">
    <head>
        <link rel="stylesheet" href="/static/css/foundation.min.css" />
        <script src="/static/js/angular.min.js"></script>
        <script>
            angular.module('app', [])
                .controller('App', function($scope, $http) {
                    var user_id = document.URL.split('/')[4].split('.')[0]
                    $http.get('/profile/' + user_id + '.json')
                         .then(function(res) {
                            var preferences = res.data['preferences']
                            var document_ids = []
                            for(var i = 0; i < preferences.length; i++) {
                                document_ids.push(preferences[i]['attraction_id'])
                            }
                            return $http.get('/docs/_mult?ids=' +  document_ids.join())
                         })
                         .then(function(res) {
                            $scope.documents = res.data['documents']
                         })
                })
        </script>
    </head>
    <body ng-controller="App">
        <div class="row">
            <div class="large-12 columns">
                <h1>Places viewed</h1>
                <div ng-repeat="document in documents">
                    <h2><a href="{{ document.url }}">{{ document.title }}</a></h2>
                    <p>{{ document.description }}</p>
                </div>
            </div>
        </div>
    </body>
</html>
